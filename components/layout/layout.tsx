import { ReactElement, useContext, useEffect, useState } from 'react'

import Head from 'next/head'

import Header from '../organisms/Header'
import Navigator from '../organisms/Navigator'
import { getMyAuth } from '../../utils/firebase/Auth'
import { onAuthStateChanged } from 'firebase/auth'
import { authLoading, userInfo } from '../../utils/recoil/ExercisesState'
import { useRecoilState } from 'recoil'
import styled from 'styled-components'

type LayoutProps = {
  children: ReactElement
}

const Container = styled.div`
  width: 100%;
  margin: 0 auto 0;
`

const Layout = ({ children }: LayoutProps) => {
  const [loading, setLoading] = useRecoilState(authLoading)
  const [user, setUser] = useRecoilState(userInfo)

  useEffect(() => {
    const auth = getMyAuth()
    const listener = onAuthStateChanged(auth.auth, (user) => {
      if (user) {
        const uid = user.uid
        console.log(uid)
        setUser({
          email: user.email!,
          displayName: user.displayName!,
        })
        setLoading(false)
      } else {
        setLoading(false)
      }
    })

    return () => {
      listener()
    }
  })

  return (
    <Container>
      <Head>
        <title>Work Out</title>
        <meta
          name="description"
          content="Generated by create next app"
        />
        <meta
          name="description"
          property="og:description"
          content="자신의 운동을 기록하세요."
        />
        <link
          rel="icon"
          href="/favicon.ico"
        />
      </Head>

      {/* {activeNotification && (
        <Notification
          message={'123'}
          status={true}
          title={'title'}
        />
      )} */}
      <Header />

      {children}

      <Navigator />
    </Container>
  )
}

export default Layout
